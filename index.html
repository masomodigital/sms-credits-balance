<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>User Lookup</title>
  <style>
    /* Your existing styles here */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 2em;
      max-width: 400px;
      margin: auto;
      background: #f9f9f9;
      color: #333;
      position: relative;
      min-height: 600px; /* make space for ticker */
    }
    /* ... all your existing styles ... */

    /* New styles for the fading ticker */
    #ticker {
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      max-width: 400px;
      background: #222;
      color: #eee;
      padding: 0.8em 1em;
      border-radius: 8px;
      font-weight: bold;
      font-size: 1em;
      box-shadow: 0 2px 10px rgba(0,0,0,0.5);
      text-align: center;
      opacity: 0;
      transition: opacity 1s ease-in-out;
      pointer-events: none;
      user-select: none;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      z-index: 9999;
      min-height: 24px;
    }
    #ticker.visible {
      opacity: 1;
      pointer-events: auto;
    }
  </style>
</head>
<body>

  <h2>User Lookup by National ID</h2>

  <label for="nationalId">Enter National ID</label>
  <input type="text" id="nationalId" placeholder="e.g. 12345678" />
  <button id="lookupBtn">Lookup</button>

  <div class="message" id="message"></div>

  <div class="result" id="result" style="display:none;">
    <p><span class="label">Name:</span><span id="name"></span></p>
    <p><span class="label">Phone Number:</span><span id="phone"></span></p>
    <p>
      <span class="label">Promo Code:</span>
      <input type="text" id="promoCode" class="copyable" readonly />
      <button class="copy-button" id="copyBtn">Copy</button>
    </p>
    <p><span class="label">Earnings:</span><span id="earnings"></span></p>
    <p><span class="label">Credits:</span><span id="credits" class="credits"></span></p>
  </div>

  <!-- New ticker div -->
  <div id="ticker" aria-live="polite" aria-atomic="true"></div>

  <script>
    // Your existing lookup and copy scripts (untouched)
    const lookupBtn = document.getElementById('lookupBtn');
    const messageDiv = document.getElementById('message');
    const resultDiv = document.getElementById('result');
    const nameSpan = document.getElementById('name');
    const phoneSpan = document.getElementById('phone');
    const promoCodeInput = document.getElementById('promoCode');
    const earningsSpan = document.getElementById('earnings');
    const creditsSpan = document.getElementById('credits');
    const copyBtn = document.getElementById('copyBtn');

    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyHRUr0lqg2F-cG8lwdjH7Aqs-ohE_LQsYd-0utgl_JuuTUoVbu1feWlfzM9DDmDEj7/exec'; // Replace with your deployed URL

    lookupBtn.addEventListener('click', () => {
      const nationalId = document.getElementById('nationalId').value.trim();
      messageDiv.textContent = '';
      resultDiv.style.display = 'none';

      if (!nationalId) {
        messageDiv.style.color = 'red';
        messageDiv.textContent = 'Please enter a National ID.';
        return;
      }

      messageDiv.style.color = 'black';
      messageDiv.textContent = 'Looking up...';

      fetch(`${SCRIPT_URL}?nationalId=${encodeURIComponent(nationalId)}`)
        .then(response => response.json())
        .then(data => {
          if (data.status === 'success') {
            nameSpan.textContent = data.name;
            phoneSpan.textContent = data.phone;
            promoCodeInput.value = data.promoCode;
            earningsSpan.textContent = data.earnings.toLocaleString();
            creditsSpan.textContent = data.credits;

            resultDiv.style.display = 'block';
            messageDiv.textContent = '';
          } else if (data.status === 'not_found') {
            messageDiv.style.color = 'red';
            messageDiv.textContent = 'User not found.';
          } else {
            messageDiv.style.color = 'red';
            messageDiv.textContent = data.message || 'Error occurred.';
          }
        })
        .catch(err => {
          messageDiv.style.color = 'red';
          messageDiv.textContent = 'Failed to fetch data. Check your connection.';
          console.error(err);
        });
    });

    copyBtn.addEventListener('click', () => {
      promoCodeInput.select();
      promoCodeInput.setSelectionRange(0, 99999); // For mobile
      document.execCommand('copy');
      copyBtn.textContent = 'Copied!';
      setTimeout(() => copyBtn.textContent = 'Copy', 1500);
    });

    // --- FADING MESSAGES TICKER SCRIPT ---

    const ticker = document.getElementById('ticker');

    // Sample first names
    const names = [
      "Patrick", "Julius", "Daniel", "Mary", "Brian", "Esther",
      "Grace", "Kevin", "Faith", "James", "Lucy", "Michael",
      "Paul", "Susan", "John", "Rachel", "David", "Alice"
    ];

    // Safaricom prefixes
    const prefixes = [
      "0721", "0722", "0723", "0724", "0725", "0726", "0727", "0728", "0729",
      "0710", "0711", "0712", "0713", "0714"
    ];

    // Time phrases - ensure unique usage before cycling
    const timePhrases = [
      "just now", "an hour ago", "two hours ago", "three hours ago",
      "four hours ago", "five hours ago", "six hours ago", "seven hours ago",
      "eight hours ago", "nine hours ago", "ten hours ago"
    ];

    let usedTimeIndices = new Set();

    function getRandomName() {
      return names[Math.floor(Math.random() * names.length)];
    }

    function getRandomPrefix() {
      return prefixes[Math.floor(Math.random() * prefixes.length)];
    }

    // Mask phone number like 0724xxxxx8
    function getRandomMaskedNumber() {
      const prefix = getRandomPrefix();
      // Random last digit 0-9
      const lastDigit = Math.floor(Math.random() * 10);
      return prefix + "xxxxx" + lastDigit;
    }

    // Random amount between 300 and 3000, two decimals
    function getRandomAmount() {
      return (Math.floor(Math.random() * (3000 - 300 + 1)) + 300).toFixed(2);
    }

    function getUniqueTimePhrase() {
      if (usedTimeIndices.size === timePhrases.length) {
        usedTimeIndices.clear();
      }
      let idx;
      do {
        idx = Math.floor(Math.random() * timePhrases.length);
      } while (usedTimeIndices.has(idx));
      usedTimeIndices.add(idx);
      return timePhrases[idx];
    }

    // Compose message string
    function composeMessage() {
      const name = getRandomName();
      const amount = getRandomAmount();
      const number = getRandomMaskedNumber();
      const time = getUniqueTimePhrase();
      return `${name} has just received Ksh.${amount} via MPESA number ${number} ${time}!`;
    }

    // Show message with fade in/out effect
    function showNextMessage() {
      const msg = composeMessage();
      ticker.classList.remove('visible');
      // fade out
      setTimeout(() => {
        ticker.textContent = msg;
        ticker.classList.add('visible');
      }, 1000);
    }

    // Start the ticker loop
    function startTicker() {
      showNextMessage();
      setInterval(() => {
        ticker.classList.remove('visible');
        setTimeout(() => {
          showNextMessage();
        }, 1000);
      }, 6000); // 6 seconds per message visible
    }

    // Run ticker on page load
    window.addEventListener('load', startTicker);

  </script>

</body>
</html>
